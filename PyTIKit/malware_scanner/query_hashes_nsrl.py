from pyhashlookup import Hashlookup

# Function to query NSRL DB via CIRCL
def query_circl(hashes):
    # Create an instance of the Hashlookup class to access functions
    hashlookup = Hashlookup()
    try:
        for md5_hash in list(hashes.values()):
            # Store response from API in response variable
            response = hashlookup.md5_lookup(md5_hash)
            # Check response is not null, caontains a 'soruce' key and the value attached to the key is RDS.db
            if response and 'source' in response and response['source'] == 'RDS.db':
                # Use a loop to iterate through the dictionary and delete entries that have a return from the RDS.db
                for key in hashes.keys():
                    if hashes[key] == md5_hash:
                        del hashes[key]
                        break
    except Exception as e:
            print(f"An unexpected error has occured : {str(e)}")
    
        
    return hashes